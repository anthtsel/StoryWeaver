(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2751:(e,r,s)=>{Promise.resolve().then(s.bind(s,4353))},4353:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>W});var t=s(5155),a=s(2115),l=s(4477);let n=(0,l.createServerReference)("40b323b92f6fbe149668e870a2075c7c771eee4a14",l.callServer,void 0,l.findSourceMapURL,"seedStory"),i=(0,l.createServerReference)("405b45506e465edde407dc0607033be947b7b83a9b",l.callServer,void 0,l.findSourceMapURL,"generateStorySnippet");var o=s(9708),d=s(2085),c=s(2596),m=s(9688);function u(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return(0,m.QP)((0,c.$)(r))}let f=(0,d.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),p=a.forwardRef((e,r)=>{let{className:s,variant:a,size:l,asChild:n=!1,...i}=e,d=n?o.DX:"button";return(0,t.jsx)(d,{className:u(f({variant:a,size:l,className:s})),ref:r,...i})});p.displayName="Button";var h=s(6936),x=s(8027),g=s(7554),y=s(172);let b=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:u("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});b.displayName="Card";let v=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:u("flex flex-col space-y-1.5 p-6",s),...a})});v.displayName="CardHeader";let j=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:u("text-2xl font-semibold leading-none tracking-tight",s),...a})});j.displayName="CardTitle";let N=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:u("text-sm text-muted-foreground",s),...a})});N.displayName="CardDescription";let w=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:u("p-6 pt-0",s),...a})});w.displayName="CardContent",a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:u("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter";var S=s(9892),C=s(9556),k=s(7381),R=s(518);let A=S.bL;S.YJ;let E=S.WT,T=a.forwardRef((e,r)=>{let{className:s,children:a,...l}=e;return(0,t.jsxs)(S.l9,{ref:r,className:u("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...l,children:[a,(0,t.jsx)(S.In,{asChild:!0,children:(0,t.jsx)(C.A,{className:"h-4 w-4 opacity-50"})})]})});T.displayName=S.l9.displayName;let M=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(S.PP,{ref:r,className:u("flex cursor-default items-center justify-center py-1",s),...a,children:(0,t.jsx)(k.A,{className:"h-4 w-4"})})});M.displayName=S.PP.displayName;let z=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(S.wn,{ref:r,className:u("flex cursor-default items-center justify-center py-1",s),...a,children:(0,t.jsx)(C.A,{className:"h-4 w-4"})})});z.displayName=S.wn.displayName;let L=a.forwardRef((e,r)=>{let{className:s,children:a,position:l="popper",...n}=e;return(0,t.jsx)(S.ZL,{children:(0,t.jsxs)(S.UC,{ref:r,className:u("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...n,children:[(0,t.jsx)(M,{}),(0,t.jsx)(S.LM,{className:u("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,t.jsx)(z,{})]})})});L.displayName=S.UC.displayName,a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(S.JU,{ref:r,className:u("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})}).displayName=S.JU.displayName;let P=a.forwardRef((e,r)=>{let{className:s,children:a,...l}=e;return(0,t.jsxs)(S.q7,{ref:r,className:u("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(S.VF,{children:(0,t.jsx)(R.A,{className:"h-4 w-4"})})}),(0,t.jsx)(S.p4,{children:a})]})});P.displayName=S.q7.displayName,a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(S.wv,{ref:r,className:u("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=S.wv.displayName;var U=s(7028);let F=a.forwardRef((e,r)=>{let{className:s,children:a,...l}=e;return(0,t.jsxs)(U.bL,{ref:r,className:u("relative overflow-hidden",s),...l,children:[(0,t.jsx)(U.LM,{className:"h-full w-full rounded-[inherit]",children:a}),(0,t.jsx)(_,{}),(0,t.jsx)(U.OK,{})]})});F.displayName=U.bL.displayName;let _=a.forwardRef((e,r)=>{let{className:s,orientation:a="vertical",...l}=e;return(0,t.jsx)(U.VM,{ref:r,orientation:a,className:u("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...l,children:(0,t.jsx)(U.lr,{className:"relative flex-1 rounded-full bg-border"})})});_.displayName=U.VM.displayName;var D=s(7489);let I=a.forwardRef((e,r)=>{let{className:s,orientation:a="horizontal",decorative:l=!0,...n}=e;return(0,t.jsx)(D.b,{ref:r,decorative:l,orientation:a,className:u("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",s),...n})});I.displayName=D.b.displayName;var O=s(5863);let V=a.forwardRef((e,r)=>{let{className:s,value:a,...l}=e;return(0,t.jsx)(O.bL,{ref:r,className:u("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...l,children:(0,t.jsx)(O.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})});V.displayName=O.bL.displayName;let q=["space","fantasy","horror"],H=["hero-journey","mystery","quest","revenge","romance"],G=[{name:"setup",maxProgress:15},{name:"rising action",maxProgress:40},{name:"confrontation",maxProgress:65},{name:"climax",maxProgress:85},{name:"resolution",maxProgress:100}],J={setup:5,"rising action":10,confrontation:10,climax:5,resolution:5},Y=Object.values(J).reduce((e,r)=>e+r,0);function W(){let[e,r]=(0,a.useState)(q[0]),[s,l]=(0,a.useState)(H[0]),[o,d]=(0,a.useState)([]),[c,m]=(0,a.useState)([]),[u,f]=(0,a.useState)([]),[S,C]=(0,a.useState)(!1),[k,R]=(0,a.useState)(null),[M,z]=(0,a.useState)(!1),[U,_]=(0,a.useState)(!1),[D,O]=(0,a.useState)(0),[W,X]=(0,a.useState)("setup"),[B,K]=(0,a.useState)(!1),[Q,Z]=(0,a.useState)(0),$=(0,a.useRef)(null);(0,a.useEffect)(()=>{_(window.matchMedia("(prefers-color-scheme: dark)").matches)},[]),(0,a.useEffect)(()=>{let e=window.document.documentElement;U?e.classList.add("dark"):e.classList.remove("dark")},[U]),(0,a.useEffect)(()=>{let r=async()=>{C(!0),R(null),O(0),X("setup"),K(!1),Z(0);try{let r=await n({theme:e,arcType:s}),t=r.initialChoices||["Explore the surroundings","Continue forward","Go back"];m([r.storySeed]),d([r.storySeed]),f(t),z(!0),console.log("Story initialized:",{snippet:r.storySeed,choices:t,arcType:s})}catch(e){R(e.message||"Failed to seed story."),console.error("Failed to seed story:",e)}finally{C(!1)}};M||r()},[e,s,M]),(0,a.useEffect)(()=>{if(c.length>0&&(0===o.length||c.length>o.length)){let e=c.length-1,r=c[e],s=[...c.slice(0,e)];s.push(""),d(s);let t="",a=0,l=setInterval(()=>{a<r.length?(t=r.substring(0,a+1),d(s=[...c.slice(0,e),t]),a++):(clearInterval(l),d([...c]),console.log("Typewriter effect completed for snippet:",e))},20);return()=>clearInterval(l)}},[c]),(0,a.useEffect)(()=>{if($.current){let e=$.current.querySelector("[data-radix-scroll-area-viewport]");e&&(e.scrollTop=e.scrollHeight)}},[o]),(0,a.useEffect)(()=>{if(B)return;let e=Math.min(Math.floor(Q/Y*100),100),r=0,s=0;for(let e=0;e<Object.keys(J).length;e++){let t=Object.keys(J)[e];if(Q<(s+=J[t])){r=e;break}}Q>=Y&&(r=G.length-1),X(G[r].name),O(e),e>=100&&console.log("Story progress reached 100%")},[Q,B]);let ee=async r=>{if(S)return;C(!0),R(null),console.log("User selected choice:",r),m([...c,"You chose: ".concat(r)]);let t=Q+1;Z(t);let a=Math.min(Math.floor(t/Y*100),100);try{let l=await i({theme:e,arcType:s,previousSnippets:c,currentChoice:r});if(console.log("Generated new snippet:",{snippetLength:l.nextSnippet.length,choices:l.nextChoices,storyPhase:W,progress:a,choicesMade:t,totalChoices:Y}),m(e=>[...e,l.nextSnippet]),a>=100){er();return}l.nextChoices&&Array.isArray(l.nextChoices)&&l.nextChoices.length>0?f(l.nextChoices):(f(["Explore further","Talk to someone nearby","Change direction"]),console.warn("No choices returned from API, using fallback choices"))}catch(e){R(e.message||"Failed to generate next snippet."),console.error("Failed to generate next snippet:",e),m(e=>[...e,"There was a problem continuing your adventure. Please try again."])}finally{C(!1)}},er=async()=>{try{D<100&&O(100),m(e=>{let r=e[e.length-1];return r.includes("THE END")||r.includes("The End")?e:[...e,"\n\nYour journey has reached its conclusion. THE END."]}),K(!0),f([]),X("complete")}catch(e){console.error("Error completing story:",e)}},es=()=>{m([]),d([]),f([]),z(!1),O(0),X("setup"),K(!1),Z(0)},et=e=>e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen py-2 bg-background",children:[(0,t.jsx)("div",{className:"absolute top-4 right-4",children:(0,t.jsxs)(p,{onClick:()=>_(!U),variant:"ghost",className:"w-9 p-0","aria-label":"Toggle Dark Mode",children:[U?(0,t.jsx)(h.A,{size:20}):(0,t.jsx)(x.A,{size:20}),(0,t.jsx)("span",{className:"sr-only",children:"Toggle Dark Mode"})]})}),(0,t.jsx)("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:(0,t.jsxs)(b,{className:"w-full max-w-3xl mx-auto my-10 rounded-lg shadow-md",children:[(0,t.jsxs)(v,{children:[(0,t.jsx)(j,{className:"text-2xl font-semibold tracking-tight",children:"Story Weaver"}),(0,t.jsx)(N,{children:"Create your own adventure with AI."})]}),(0,t.jsxs)(w,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("label",{htmlFor:"theme",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Theme:"}),(0,t.jsxs)(A,{value:e,onValueChange:e=>{r(e),es()},disabled:S,children:[(0,t.jsx)(T,{className:"w-[120px]",id:"theme",children:(0,t.jsx)(E,{placeholder:"Theme"})}),(0,t.jsx)(L,{children:q.map(e=>(0,t.jsx)(P,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("label",{htmlFor:"arcType",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Story Arc:"}),(0,t.jsxs)(A,{value:s,onValueChange:e=>{l(e),es()},disabled:S,children:[(0,t.jsx)(T,{className:"w-[140px]",id:"arcType",children:(0,t.jsx)(E,{placeholder:"Arc Type"})}),(0,t.jsx)(L,{children:H.map(e=>(0,t.jsx)(P,{value:e,children:et(e)},e))})]})]}),(0,t.jsxs)(p,{variant:"outline",size:"sm",onClick:es,disabled:S,className:"ml-auto",children:[(0,t.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"New Story"]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:W.charAt(0).toUpperCase()+W.slice(1)}),(0,t.jsxs)("span",{children:[D,"% (",Math.max(0,Y-Q)," choices remaining)"]})]}),(0,t.jsx)(V,{value:D,className:"h-2"})]}),(0,t.jsx)(I,{}),k&&(0,t.jsx)("div",{className:"bg-destructive/15 text-destructive p-3 rounded-md text-sm",children:k}),(0,t.jsxs)(F,{className:"h-[300px] rounded-md border p-4",ref:$,children:[o.map((e,r)=>(0,t.jsx)("div",{className:"mb-4 text-sm",children:(0,t.jsx)("p",{children:e})},r)),S&&(0,t.jsxs)("div",{className:"flex items-center justify-center py-2",children:[(0,t.jsx)(y.A,{className:"h-4 w-4 animate-spin mr-2"}),(0,t.jsx)("span",{className:"text-sm italic",children:"Generating story..."})]})]}),(0,t.jsx)("div",{className:"flex flex-wrap justify-center gap-2 mt-4",children:u.length>0&&!B?u.map(e=>(0,t.jsx)(p,{onClick:()=>ee(e),disabled:S,className:"m-1",children:e},e)):B&&(0,t.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,t.jsx)("p",{className:"italic mb-2",children:"The story has reached its conclusion."}),(0,t.jsx)(p,{onClick:es,variant:"outline",children:"Start a New Adventure"})]})})]})]})})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[255,441,684,358],()=>r(2751)),_N_E=e.O()}]);